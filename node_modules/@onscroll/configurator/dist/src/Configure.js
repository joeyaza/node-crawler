"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var InvalidConfigException_1 = require("./Exceptions/InvalidConfigException");
var _ = require("lodash");
var fs = require("fs");
require("rootpath")();
var CONFIG_PATH = "config.json";
function Configure(configPropertyName, defaults) {
    if (defaults === void 0) { defaults = {}; }
    return function (target, key) {
        try {
            var configJSON = fs.readFileSync(CONFIG_PATH).toString();
            var config = _.reduce(_.split(configPropertyName, "."), function (reduced, key) {
                return reduced[key];
            }, JSON.parse(configJSON));
            target[key] = _.merge(defaults, config);
            if (_.isEmpty(target[key])) {
                throw new InvalidConfigException_1.InvalidConfigException("Empty config found under: " + configPropertyName);
            }
        }
        catch (exception) {
            throw new InvalidConfigException_1.InvalidConfigException(configPropertyName + ": " + exception.message);
        }
    };
}
exports.Configure = Configure;
